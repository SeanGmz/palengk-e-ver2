<!DOCTYPE html>
<html>
  <head>
    <title>Orders</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles/shared/styles.css" />
    <link rel="stylesheet" href="styles/shared/main-header.css" />
    <link rel="stylesheet" href="styles/pages/orders.css" />
  </head>
  <body>
    <div class="main-header">
      <!-- Main header content -->
    </div>

    <div class="main">
      <div class="page-title">Your Orders</div>

      <div class="orders-grid">
        <!-- Orders will be dynamically rendered here -->
      </div>
    </div>
    <script type="module" src="scripts/script.js"></script>
    <script type="module" src="data/orders.js"></script>
    <script type="module" src="data/products.js"></script>
    <script type="module">
      import { orders } from "./data/orders.js";
      import { getProduct } from "./data/products.js";

      const ordersGrid = document.querySelector(".orders-grid");

      orders.forEach((order) => {
        const orderContainer = document.createElement("div");
        orderContainer.classList.add("order-container");

        // Create and append order header
        const orderHeader = document.createElement("div");
        orderHeader.classList.add("order-header");

        const orderHeaderLeft = document.createElement("div");
        orderHeaderLeft.classList.add("order-header-left-section");
        orderHeaderLeft.innerHTML = `
          <div class="order-date">
            <div class="order-header-label">Order Placed:</div>
            <div>${order.orderTime}</div>
          </div>
          <div class="order-total">
            <div class="order-header-label">Total:</div>
            <div>${(order.totalCostCents / 100).toFixed(2)}</div>
          </div>
        `;

        const orderHeaderRight = document.createElement("div");
        orderHeaderRight.classList.add("order-header-right-section");
        orderHeaderRight.innerHTML = `
          <div class="order-header-label">Order ID:</div>
          <div>${order.id}</div>
        `;

        orderHeader.appendChild(orderHeaderLeft);
        orderHeader.appendChild(orderHeaderRight);

        orderContainer.appendChild(orderHeader);

        // Create and append order details grid
        const orderDetailsGrid = document.createElement("div");
        orderDetailsGrid.classList.add("order-details-grid");

        order.products.forEach((product) => {
          // Fetch product details using getProduct function
          const productDetails = getProduct(product.productId);

          // Create and append product details
          const productContainer = document.createElement("div");
          productContainer.classList.add("product-container");

          const productImageContainer = document.createElement("div");
          productImageContainer.classList.add("product-image-container");
          productImageContainer.innerHTML = `<img src="${productDetails.image}" alt="${productDetails.name}" />`;

          const productDetailsElement = document.createElement("div");
          productDetailsElement.classList.add("product-details");
          productDetailsElement.innerHTML = `
            <div class="product-name">${productDetails.name}</div>
            <div class="product-delivery-date">Arriving on: ${product.estimatedDeliveryTime}</div>
            <div class="product-quantity">Quantity: ${product.quantity}</div>
          `;

          const productActions = document.createElement("div");
          productActions.classList.add("product-actions");
          productActions.innerHTML = `
            <a href="tracking.html?orderId=${order.id}&productId=${product.productId}">
              <button class="track-package-button button-secondary">Track package</button>
            </a>
          `;

          productContainer.appendChild(productImageContainer);
          productContainer.appendChild(productDetailsElement);
          productContainer.appendChild(productActions);

          orderDetailsGrid.appendChild(productContainer);
        });

        orderContainer.appendChild(orderDetailsGrid);
        ordersGrid.appendChild(orderContainer);
      });
    </script>
  </body>
</html>
